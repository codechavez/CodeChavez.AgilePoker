name: CodeChavez Agile Poker CD
on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
    build-and-push:
        runs-on: ubuntu-latest

        steps:
            - name: âš”ï¸ Checkout repository
              uses: actions/checkout@v3

            - name: ğŸ› ï¸ Setup .NET 9
              uses: actions/setup-dotnet@v3
              with:
                dotnet-version: '9.0.x'

            - name: ğŸ“¦ Restore packages
              run: dotnet restore

            - name: ğŸ—ï¸ Build the app
              run: dotnet build --no-restore --configuration Release

            - name: ğŸš€ Publish the app
              run: dotnet publish --no-build --configuration Release --output ./publish

            - name: ğŸ” Log in to Docker Hub
              uses: docker/login-action@v2
              with:
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_PASSWORD }}              
              
            - name: ğŸ³ Build Docker image
              run: |
                docker build -f .docker/agile.poker.Dockerfile -t teslacode/codechavez.agile.poker:1.0.0 .

            - name: ğŸ“¤ Push Docker image to Docker Hub
              run: |
                docker push teslacode/codechavez.agile.poker:1.0.0

